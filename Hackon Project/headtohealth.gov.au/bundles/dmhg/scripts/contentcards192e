var Card=function(n,t){var i=this;i.ItemId=n.ItemId;i.TemplateName=n.TemplateName;i.ActionUrl=n.ActionUrl;i.ActionTarget=n.ActionTarget;i.ActionText=n.ActionText;i.Price=n.Price;i.Time=n.Time;i.Title=n.Title?n.Title.trim():null;i.Summary=n.ShortDescription;i.CategoryName=n.CategoryName;i.CardImage=n.CardImage;i.ModalImage=n.ModalImage;i.ProviderName=n.ProviderName;i.DisableWhiteBorderOnModalImage=n.DisableWhiteBorderOnModalImage;i.ResourceProvider=n.ResourceProvider;i.ResourceProviderLogo=n.ResourceProviderLogo;i.ResourceProviderLogoWhite=n.ResourceProviderLogoWhite;i.ContactTypeName=n.ContactTypeName;i.ContactTypeImage=n.ContactTypeImage;i.ContactDetails=n.ContactDetails;i.Description=n.Description;i.BackgroundColor=n.BackgroundColor;i.ShortDescription=n.ShortDescription;i.CardButtonText=n.CardButtonText;i.CardButtonAccessibilityText=n.CardButtonAccessibilityText;i.ExtraFeatures=n.ExtraFeatures;i.ModalPageUrl=n.ModalPageUrl;i.Index=t;i.NoAnimation=!1;i.NoFocus=!1;i.AfterRender=function(n){ContentCards.afterRenderHandler(n,i.Index,i.NoAnimation,i.NoFocus)}};
function ContentCardsContainer(n,t){this.loadCardsCallback=n;this.doNotLoadDelegate=t;this.scrollHandler=function(n,t){if(!isDesktop()&&!this.doNotLoadDelegate()){var i=$(t.target),u=i.children(".content-card").last(),r=u.offset().left+u.width()-i.offset().left;r=r-200;r<=i.width()&&this.loadCardsCallback!==null&&this.loadCardsCallback(i.attr("data-category-name"))}}};
var SearchModel=function(n){var t=this;t.CardCategories=ko.observableArray([]);t.Total=ko.observable().extend({notify:"always"});t.TotalResources=ko.observable();t.CategoryList=ko.observableArray([]);t.CategoryListWithIcon=ko.observableArray([]);t.AllCategories=ko.observableArray([]);t.NoResultsTexts=ko.observable();t.Seed=ko.observable();t.GenerateNewSeed=ko.observable("false");t.EnableSuggestion=ko.observable().extend({notify:"always"});t.Suggestion=ko.observable();t.OriginalTerm=ko.observable("");t.SpellCheckKeywords=ko.observable(!0);t.ApplicableFilters=ko.observableArray([]);t.Pagination=null;t.NumCardsToShow=ko.observable(0);t.FilterModel=ko.observable(n);t.ContentCardsContainerHandler=null;t.IsLoadingResults=ko.observable().extend({notify:"always"});t.IsLoadingMoreCards=ko.observable().extend({notify:"always"});t.IsReady=ko.observable(!1).extend({notify:"always"});t.tags="";t.dstFilters=[];t.dstSearchText="";t.IsSearchPage=ko.observable(!1);t.IsTopicPage=ko.observable(!1);t.IsSavedCardsPage=ko.observable(!1);t.IsShareResourcesPage=ko.observable(!1);t.IsSingleCard=ko.observable(!1);t.IsInGridView=ko.observable(!0);t.RefreshShownCards=function(n,i){var u=t.Pagination||{},r=0,f=1e6,e=!1;t.IsShareResourcesPage()?(r=f,e=!0):t.IsSavedCardsPage()?(r=f,e=!0):r=t.IsTopicPage()?isDesktop()?2:f:t.FilterModel().SearchType()===Constants.SearchType.Dst?u.NumShowDST:t.IsInGridView()?isDesktop()?u.NumShowGridDesktop:isTablet()?u.NumShowGridTablet:u.NumShowGridMobile:isDesktop()?u.NumShowListDesktop:isTablet()?u.NumShowListTablet:u.NumShowListMobile;r&&(r=ko.isObservable(r)?r():r,t.NumCardsToShow(r),t.CardCategories().forEach(function(t){var u=t.Cards(),o=t.PreloadedCards(),s=u.length,h=t.NumRequestedCards(),c;r===f?h=f:s<r?(u=u.concat(o.slice(0,r-s).map(function(n){return n.NoAnimation=!0,n.NoFocus=!0,n})),o.splice(0,r-s)):s>r&&(!t.HasShownMore()||t.Name()===n)&&(o=o.concat(u.slice(-(s-r))),u=u.slice(0,r));h>0&&(c=o.slice(0,h),h-=Math.min(c.length,o.length),u=u.concat(c.map(function(n,t){return n.Index=t,n.NoAnimation=i,n.NoFocus=e,n})),o.splice(0,c.length));t.NumRequestedCards(h);t.Cards(u);t.PreloadedCards(o)}),t.StoreCardsInCache())};t.IsInGridView.subscribe(function(){t.RefreshShownCards()});t.HasDisplayedAllCardsFromCategory=function(n){return t.CardCategories().filter(function(t){return t.Name()===n}).some(function(n){return n.Cards().length>=n.TotalCards()})};t.MapJsonToCards=function(n){t.CardCategories.removeAll();t.CategoryListWithIcon(n.CategoryTotal);t.CategoryList(n.CategoryTotal.map(function(n){return n.CategoryName}));t.AllCategories(t.CategoryList().slice(0));t.CategoryList().forEach(function(i){var e=n.CardList.filter(function(n){return n.CategoryName===i}).map(function(n){return new Card(n)}),f=0,r,u;n.CategoryTotal.filter(function(n){return n.Category===i}).forEach(function(n){f=n.TotalCards},0);r="";u="";t.CategoryListWithIcon().filter(function(n){return n.CategoryName===i}).forEach(function(n){r=n.CategoryIconSrc;u=n.CategoryDescription});t.CardCategories.push(new Category(i,e,n.Pagination.CurrentPage,n.Pagination.PageSize,f,r,u))});t.RefreshShownCards();t.EnableSuggestion(n.EnableSuggestion);t.Suggestion(n.Suggestion);t.OriginalTerm(n.OriginalTerm);t.ApplicableFilters(n.ApplicableFilters);t.Seed(n.Seed);t.Total(n.Pagination.Total);t.TotalResources(t.Total()+" resource"+(t.Total()===1?"":"s"))};t.GetCardDetails=function(n){for(var i=0;i<t.CardCategories();i++)return t.CardCategories()[i].find(function(t){return t.ItemId===n});return null};t.StoreCardsInCache=function(){if(t.IsSearchPage()){var n=ko.mapping.toJS(t);n.IsLoadingResults=!1;n.IsLoadingMoreCards=!1;store.session.set(Constants.SessionStorage.CardCache,n)}};t.ClearCurrentCache=function(){store.session.remove(Constants.SessionStorage.CardCache)};t.GetCacheCardDetails=function(){var n=store.session.get(Constants.SessionStorage.CardCache),i={CardCategories:{create:function(n){return ko.mapping.fromJS(n.data,{Cards:{create:function(n){return new Card(n.data)}},PreloadedCards:{create:function(n){return new Card(n.data)}}})}},NoResultsTexts:{create:function(){return undefined}}};ko.mapping.fromJS(n,i,t);n.CardCategories&&n.CardCategories.length!==0||(t.FilterModel().RemoveFilters(),t.FilterModel().Keywords(""),t.GetCards())};t.AjaxGetCards=function(n,i){return $.ajax({url:"/dmhgapi/ContentCardSearch/CardSearch",type:"POST",data:ko.toJSON(t.FiltersToJson(n,i)),contentType:"application/json; charset=utf-8"})};t.GetCards=function(n,i){if(t.GenerateNewSeed()==="true"&&t.Seed(0),!n&&t.dstFilters.length>0&&(t.dstFilters.forEach(function(n){t.FilterModel().PushFilter(n.SearchGroupName,n.Guid,n.SearchName,!0)}),t.tags.split("~").forEach(function(n){var i=n.split("|");i[0]!==""&&t.FilterModel().PushFilter(i[0].trim(),i[1].trim())})),n){n.HasShownMore(!0);var u=n.Cards().length+n.PreloadedCards().length>=n.TotalCards(),r=!1;if(i){if(u){n.NumRequestedCards(n.PreloadedCards().length);t.RefreshShownCards(null,!0);t.IsLoadingResults(!1);t.IsLoadingMoreCards(!1);return}r=!0}else{if(n.NumRequestedCards(n.NumRequestedCards()+t.NumCardsToShow()),t.RefreshShownCards(),u){t.IsLoadingResults(!1);t.IsLoadingMoreCards(!1);return}r=n.NumRequestedCards()>0}r&&(n.Cards.push(new SpinnerCard(n.Name())),n.IsLoading(!0),t.IsLoadingResults(!0),t.IsReady(!0));n.CurrentPage(n.CurrentPage()+1)}else t.IsLoadingResults(!0),t.IsReady(!0);t.AjaxGetCards(n,i).done(function(r){var u=$.parseJSON(r);t.Pagination=u.Pagination;n?(n.Cards(n.Cards().filter(function(n){return!(n instanceof SpinnerCard)})),u.CardList.forEach(function(t,i){n.PreloadedCards.push(new Card(t,i))}),n.PageSize(u.Pagination.PageSize),i&&n.NumRequestedCards(n.PreloadedCards().length),t.RefreshShownCards(null,i),n.IsLoading(!1)):u.CardList.length===0?(t.ClearCurrentCache(),t.CardCategories.removeAll(),t.Total(0),t.GetNoResultsTexts(),t.EnableSuggestion(u.EnableSuggestion),t.Suggestion(u.Suggestion),t.OriginalTerm(u.OriginalTerm),t.SpellCheckKeywords(!0)):(t.CardCategories.removeAll(),t.MapJsonToCards(u),t.StoreCardsInCache());t.IsLoadingResults(!1);t.IsLoadingMoreCards(!1)}).fail(function(){t.CardCategories.removeAll();t.Total(0);t.GetNoResultsTexts();n&&n.IsLoading(!1);t.IsLoadingResults(!1);t.IsLoadingMoreCards(!1)})};t.GetInitialCards=function(){this.CategoryList.removeAll();this.GenerateNewSeed("true");this.GetCards()};t.ShowMore=function(n,i){t.HasDisplayedAllCardsFromCategory(n)||t.CardCategories().filter(function(t){return t.Name()===n}).forEach(function(n){t.GenerateNewSeed("false");t.IsLoadingMoreCards(!0);t.GetCards(n,i)})};t.ShowLess=function(n,i){t.CardCategories().filter(function(t){return t.Name()===n}).forEach(function(){t.RefreshShownCards(n);var r=$(i).parent();setTimeout(function(){r.find(".content-card-show-all-button").focus()},100)})};t.FiltersToJson=function(n,i){return{Keywords:t.FilterModel().Keywords,SearchFilterGroups:t.FilterModel().SearchFilterGroups,CategoryName:n?[n.Name()]:[],Page:n?n.CurrentPage():0,SearchType:t.FilterModel().SearchType(),DeviceType:getDeviceType(),Seed:t.Seed(),SpellCheckKeywords:t.SpellCheckKeywords(),ShowAll:i}};t.IsLoading=function(){return t.IsLoadingResults()||t.IsLoadingMoreCards()};t.GetEmailData=function(){var n={CardListEmailInfo:new EmailInformation(t.CardCategories(),t.FilterModel(),t.FilterModel().Keywords,t.IsSavedCardsPage(),t.IsSingleCard())};return t.dstFilters.length>0&&(n.CardListEmailInfo.Filters=n.CardListEmailInfo.Filters.filter(function(n){return t.dstFilters.map(function(n){return n.Guid}).indexOf(n)===-1}),n.CardListEmailInfo.Keywords=t.dstSearchText),ko.toJSON(n)};t.AjaxGetNoResultsTexts=function(){return $.ajax({url:"/dmhgapi/ContentCardSearch/GetNoResultsTexts",type:"GET",contentType:"application/json; charset=utf-8"})};t.GetNoResultsTexts=function(){t.NoResultsTexts()===undefined?t.AjaxGetNoResultsTexts().done(function(n){t.NoResultsTexts($.parseJSON(n));t.IsLoadingResults(!1)}):t.IsLoadingResults(!1)};t.ClearCheckbox=function(){t.FilterModel().SearchFilterGroups().forEach(function(n){n.Filters.removeAll();n.FilterIds.removeAll()});t.FilterModel().FilterName.removeAll();t.FilterModel().EmailFilters.removeAll()};t.SearchInstead=function(){t.FilterModel().Keywords(t.OriginalTerm());t.SpellCheckKeywords(!1);t.CategoryList.removeAll();t.GetCards()};t.TopicCardShowMoreCount=function(){return getDeviceType()===Constants.Device.Desktop?2:4};t.isBound=function(n){return!!ko.dataFor(document.getElementById(n))};t.ContentCardsContainerHandler=new ContentCardsContainer(t.ShowMore,t.IsLoading.bind(t));$(window).on("resize",function(){t.RefreshShownCards()})},EmailInformation=function(n,t,i,r,u){var o=this,f,e;for(o.CardList=[],o.Filters=[],o.Keywords=i,f=0;f<n.length;f++)for(e=0;e<n[f].Cards().length;e++)o.CardList.push(n[f].Cards()[e].ItemId);if(t!=null)for(f=0;f<t.SearchFilterGroups().length;++f)for(e=0;e<t.SearchFilterGroups()[f].FilterIds().length;++e)o.Filters.push(t.SearchFilterGroups()[f].FilterIds()[e]);o.IsSavedCards=r;o.IsSingleCard=u},Category=function(n,t,i,r,u,f,e){var o=this,s;for(o.Name=ko.observable(n),o.Icon=ko.observable(f),o.Description=ko.observable(e),o.Cards=ko.observableArray([]),o.PreloadedCards=ko.observableArray([]),o.CurrentPage=ko.observable(i),o.PageSize=ko.observable(r),o.TotalCards=ko.observable(u),o.NumRequestedCards=ko.observable(0),o.IsLoading=ko.observable(!1),o.HasShownMore=ko.observable(!1),o.Title=ko.computed(function(){return o.Name()+" ("+o.TotalCards()+")"}),o.NameSlug=ko.computed(function(){return slugify(o.Name())}),s=0;s<t.length;s++)o.PreloadedCards.push(t[s]);o.ShowMoreVisible=ko.computed(function(){return o.Cards().length<o.TotalCards()})},SpinnerCard=function(n){var t=this;t.TemplateName="SpinnerContentCard";t.CategoryName=n},FilterModel=function(n,t){var i=this;i.Keywords=ko.observable(n);i.SearchFilterGroups=ko.observableArray([]);i.SearchType=ko.observable(t);i.FilterName=ko.observableArray([]);i.EmailFilters=ko.observableArray([]);i.PushFilter=function(n,t,r,u){var f=i.SearchFilterGroups().filter(function(t){return t.FilterType().toLowerCase()===n.toLowerCase()}).reduce(function(n,t){return t},null),e;return f||(f={FilterType:ko.observable(n),Filters:ko.observableArray([]),FilterIds:ko.observableArray([])},i.SearchFilterGroups().push(f)),e=i.EmailFilters().filter(function(t){return t.FilterType===n&&t.FilterName===r}).reduce(function(n,t){return t},null),e||(e={FilterType:n,FilterName:r}),f.FilterIds().filter(function(n){return n===t}).length?u||(f.FilterIds.remove(t),f.Filters.remove(r),i.FilterName.remove(r),i.EmailFilters.remove(e),f.FilterIds().length===0&&i.SearchFilterGroups.remove(f)):(f.FilterIds.push(t),f.Filters.push(r),u||(i.FilterName.push(r),i.EmailFilters.push(e))),!0};i.RemoveFilters=function(){for(var t,n=0;n<i.SearchFilterGroups().length;n++)t=i.SearchFilterGroups()[n],t.FilterIds.removeAll(),t.Filters.removeAll()}};ko.bindingHandlers.InitializeAndCallMethodsAfterRunAllLoop={update:function(n,t){ko.utils.unwrapObservable(t());$(".content-card-category-tooltip-button").tooltip({trigger:"click",animation:!0,html:!0}).on("inserted.bs.tooltip",function(){var t=$(this),i=$(t.data("bs.tooltip").$tip[0]),n=$("<button />");n.attr("type","button");n.attr("aria-label","Close category description");n.addClass("icon-h2h-close");n.click(function(){t.click()});i.children(".tooltip-inner").append(n)})}};
$(function(){var n="slide",u="num-cards",t="num-slides",f=".hcl__card,.hcl__search-card",o=function(){var r=this;r.Cards=ko.observableArray([]);r.MapJsonToCards=function(n){r.Cards.removeAll();$.each(n,function(n,t){r.Cards.push(new Card(t))})};r.AfterRender=function(r){var o=$(r).first().parents(".hcl"),c=o.find(f),l=c.length,a=Math.ceil(l/4),v,s,h;for(o.data(n,0),o.data(u,l),o.data(t,a),v=o.find(".hcl__dots"),s=0;s<a;s++)h=i(o,s),v.append('<button class="hcl__dot-button" type="button" role="presentation" aria-hidden="true"><span class="sr-only">Go to cards '+h.min+" to "+h.max+"<\/span><\/button>");e(o);c.filter(".hcl__card").each(function(n,t){var i=$(t);ContentCards.addSaveButtonToCard(i)})}},s=function(){$(".hcl").each(function(){var t=$(this).find("input[name=cardListJson]").val(),i=JSON.parse(t),n=new o;n.MapJsonToCards(i);ko.applyBindings(n,this)})},h=function(){$(".hcl__cards-nav-button--next").on("click",function(t){t.preventDefault();t.stopImmediatePropagation();var i=$(this).parents(".hcl"),u=i.data(n);r(i,u+1)});$(".hcl__cards-nav-button--prev").on("click",function(t){t.preventDefault();t.stopImmediatePropagation();var i=$(this).parents(".hcl"),u=i.data(n);r(i,u-1)})},c=function(){$(".hcl__dot-button").on("click",function(n){n.preventDefault();n.stopImmediatePropagation();var t=$(this).parents(".hcl"),i=$(this).index();r(t,i)})},i=function(n,i){var r=0,f=0,e=n.data(t),o=n.data(u);return i>=0&&i<=e&&(r=1+i*4,f=i===e-1?o:(i+1)*4),{min:r,max:f}},r=function(t,i){t.data(n,i);e(t);var r=-i*980;t.find(f).css("left",r+"px")},e=function(r){var u=r.data(n),a=r.data(t),f=r.find(".hcl__cards-nav-button--prev"),e=r.find(".hcl__cards-nav-button--next"),c=$(f).find(".hcl__cards-nav-button-range"),l=$(e).find(".hcl__cards-nav-button-range"),o,s,h;c.text("");l.text("");u===0?(f.addClass("hcl__cards-nav-button--hiding"),setTimeout(function(){f.removeClass("hcl__cards-nav-button--shown");f.removeClass("hcl__cards-nav-button--hiding")},300)):(o=i(r,u-1),c.text(o.min+" to "+o.max),f.addClass("hcl__cards-nav-button--shown"));u===a-1?(e.addClass("hcl__cards-nav-button--hiding"),setTimeout(function(){e.removeClass("hcl__cards-nav-button--shown");e.removeClass("hcl__cards-nav-button--hiding")},300)):(s=i(r,u+1),l.text(s.min+" to "+s.max),e.addClass("hcl__cards-nav-button--shown"));h=r.find(".hcl__dot-button");h.removeClass("hcl__dot-button--filled");$(h.get(u)).addClass("hcl__dot-button--filled")};$(document).ready(function(){s();h();c()})});