(function(){function rt(n,t){wt&&$.contains(document,n[0])&&($(window).stop(),setTimeout(function(){n.attr("tabindex","0").focus()},350),$(window).scrollTo(n,500,{axis:"y",offset:-300+t,interrupt:!0,easing:"easeOutExpo"}))}function u(n,t){n.attr("aria-pressed",t);n.prop("disabled",t)}function ir(n){return n.attr("aria-pressed")==="true"}function rr(){return d.indexOf(ft)>0?decodeURIComponent(d.substring(d.indexOf(ft)+ft.length)):""}function ur(){var n=1;return it.length>=1?$.ajax({url:"/dmhgapi/dst/getclusterid",type:"POST"}).done(function(t){n=t.clusterid}):n=parseInt(d.substring(d.indexOf("?")+1))||1,n}function a(n,t){wt=!0;ar();setTimeout(function(){fi();setTimeout(function(){n()},500)},t?1e3:0)}function gt(n,t,i){var r=b(n.ConversationalText,i);a(function(){$.ajax({url:"/dmhgapi/dst/selectuserresponse",type:"POST",data:JSON.stringify({uniqueIdentifier:tt,resourceTypeId:ut,responseId:n.Id,stepBackQuantity:t,tags:v}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){h();et(n)})},r)}function fr(n,t,i){a(function(){$.ajax({url:"/dmhgapi/dst/selectuserscreenerresponse",type:"POST",data:JSON.stringify({uniqueIdentifier:tt,resourceTypeId:ut,screenerResults:n,stepBackQuantity:t,tags:v}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){h();et(n,i)})},!1)}function ni(n,t,i){s=n;var r=b(t,i);a(function(){$.ajax({url:"/dmhgapi/dst/freetextsearch",type:"POST",data:JSON.stringify({searchString:n}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){h();sr(n)})},r)}function er(n){ni("",i[lt],n)}function or(){$.ajax({url:"/dmhgapi/dst/getquestion",type:"POST",data:JSON.stringify({clusterId:pt,uniqueIdentifier:tt,resourceTypeId:ut}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){et(n)})}function et(n,t){if(n!==undefined){n.tags&&n.tags!==""&&(v=n.tags);yt[y]=v;n.question&&(_parentClusterId=n.question.ParentClusterId);var r=function(){if(n.freetextsettings){var t=n.question;dt=t;i=n.freetextsettings;t.Responses=[{}];ti()}else oi(n.question)},u=b(n.conversationalText,t);u?setTimeout(r,500):r()}}function sr(t){var h,a,c,e,u;if(t!==undefined){if(p=t.Suggestion,h=t.Filters,h){if(r=[],o=[],s.length){c=f[n.FreeTextState.SearchOptions];u={};u.Limit=i[c+st];u.Children=[];for(e in h)u.Children=u.Children.concat(h[e]);a=u.Children.length;l=a==1;a?r.push(u):r=null}else{c=f[n.FreeTextState.ListOfOptions];for(e in h)u={},u.Name=e,u.Order=i[c+"_"+e+yi],u.Limit=i[c+"_"+e+st],u.Children=h[e],r.push(u);r.length?r.sort(function(n,t){return n.Order-t.Order}):r=null}r&&r.reduce(function(n,t){return n.concat(t.Children.reduce(function(n,t){return t.Children.length==1&&t.Children[0].FilterDetails==="|"&&(t.Children=[]),n.concat([t],t.Children)},[]))},[]).forEach(function(n){n.Name=n.Name||n.FilterDetails;n.Description=n.Description||"No description"})}w()}}function hr(){var n={};return n._freeTextState=t,n._freeTextSearchText=s,n._freeTextSearchIsOneOption=l,n._freeTextFilterTypes=JSON.parse(JSON.stringify(r)),n._freeTextSelectedFilters=JSON.parse(JSON.stringify(o)),n._freeTextIsAtWhatNext=g,n._freeTextSearchSpellingFix=p,n}function cr(n){t=n._freeTextState;s=n._freeTextSearchText;l=n._freeTextSearchIsOneOption;r=n._freeTextFilterTypes;o=n._freeTextSelectedFilters;g=n._freeTextIsAtWhatNext;p=n._freeTextSearchSpellingFix}function ti(){t=n.FreeTextState.Start;s=null;l=!1;r=null;o=null;g=!1;p=null;w()}function w(){var c=o&&o.length,a=r&&!r.length,v=r&&r.length,b=!r,h=s&&s.length,k=!!p,u,e,y,w;t=g?n.FreeTextState.WhatNext:c&&a&&l?n.FreeTextState.ResultsSearchOneOption:c&&a?n.FreeTextState.Results:!c&&a&&l?n.FreeTextState.SearchOneOptionNo:!c&&a?n.FreeTextState.NoOptionsSelected:v&&h&&l?n.FreeTextState.SearchOneOption:v&&h&&k?n.FreeTextState.SearchOptionsSpellingFix:v&&h?n.FreeTextState.SearchOptions:v&&!h?n.FreeTextState.ListOfOptions:b&&h?n.FreeTextState.SearchNoOptions:n.FreeTextState.Start;t===n.FreeTextState.Start?u=dt:(e=f[t],t==n.FreeTextState.ListOfOptions&&(e+="_"+r[0].Name),u={Id:null,ParentClusterId:null,QuestionType:n.QuestionType.FreeText,Responses:[{}],Title:i[e+wi],AccessibilityTitle:i[e+li],AvatarType:i[e+ai],Text:i[e+pi]});t===n.FreeTextState.SearchOneOption&&(y=r[0],w=y.Children[0],u.Text=u.Text.replace("{option}",w.Name));t===n.FreeTextState.SearchOptionsSpellingFix&&(u.Text=u.Text.replace("{option}",p.trim()));oi(u)}function ii(){a(function(){h();ti()},!1)}function ri(n){r=null;s=null;l=!1;er(n)}function lr(n){var t=b(i[nt],n);a(function(){h();g=!0;w()},t)}function ui(){location.reload()}function fi(){var n=$("<div />"),t;n.addClass("dst-spinner-container");n.append('<span class="sr-only">Loading<\/span>');setTimeout(function(){n.addClass("animation-appear")},100);t=$("<div />").appendTo(n);t.addClass("spinner");n.appendTo(k);rt(n,0)}function h(){k.find(".dst-spinner-container").remove()}function ei(){var n,t;fi();n=$("#dst-results");c&&(t=c.isBound("dst-results"),t||ko.applyBindings(c,n[0]),c.CardCategories.subscribe(function(){setTimeout(function(){n.fadeIn();setTimeout(function(){rt(n,0);h()},100)},500)}));ci("show");c.FilterModel().RemoveFilters();c.tags=v;c.GetInitialCards()}function ar(){$("#dst-results").fadeOut()}function b(n,t){var r,u,i,f;return($(".dst-bottom-link-container").remove(),!n||!n.length||!t)?!1:(r=$("<div />").appendTo(t),r.addClass("dst-conversation-outer-container"),u=$("<div />").appendTo(r),u.addClass("dst-conversation-inner-container"),i=$("<div />").appendTo(u),i.addClass("dst-conversation"),f=$("<span />").appendTo(i),f.html(n),setTimeout(function(){rt(i,0);setTimeout(function(){i.addClass("animation-appear")},100)},10),!0)}function vr(n,t){window.open(t,"_blank")}function oi(n){if(n){var t=$("<div />");t.addClass("dst-question-and-conversation-container");t.attr("role","region");si(n,y,t,!1);t.appendTo(k);y++;n.Responses.length||ei()}else ei()}function si(t,i,r,u){var f=$("<div />").appendTo(r),y,o,s,h,c,l,a,v,e;f.addClass("dst-question-container");y=$("<div />").appendTo(f);y.addClass("dst-question-top-line");o=$("<div />").appendTo(f);o.addClass("dst-question-info-container");t.AvatarType!==0&&(s=null,s=$("<div />").appendTo(o),s.addClass("dst-question-info-avatar-container"),h=null,h=$("<div />").appendTo(s),h.addClass("dst-question-info-avatar"),h.addClass("dst-avatar-"+t.AvatarType),o.addClass("dst-question-info-container-avatar-"+t.AvatarType));c=$("<div />").appendTo(o);c.addClass("dst-question-info-title-and-text-container");l=null;t.Title&&(l=$("<h3 />").appendTo(c),l.addClass("dst-question-info-title").addClass("dst-question-info-title-"+t.Id),l.text(t.Title));t.AccessibilityTitle&&r.attr("aria-label",t.AccessibilityTitle);a=$("<div />").appendTo(c);a.addClass("dst-question-info-text");a.html(t.Text);v=$("<div />").appendTo(f);v.addClass("dst-question-response-container");e={};e[n.QuestionType.ButtonSet]=yr;e[n.QuestionType.Slider]=pr;e[n.QuestionType.Screener]=wr;e[n.QuestionType.FreeText]=br;e[t.QuestionType](t,i,r,f,v);setTimeout(function(){var n=0;u&&(n+=f.height()*1.4);f.focus();rt(f,n)},1);setTimeout(function(){f.addClass("animation-appear")},100)}function e(n){var e=n.questionIndex,a=n.buttonContainer,r=n.questionAndConversationContainer,o=n.text,v=n.isSubmit,f=n.url,s=n.clickCallback,y=n.checkIfAlreadySubmittedCallback,h=n.validateCallback,p=n.submitCallback,w=n.revertUIStateCallback,c=n.getFreeTextStateDataCallback,l=n.setFreeTextStateDataCallback,i=null,t=$("<button />").appendTo(a);return t.attr("type",v?"submit":"button"),t.html(o),u(t,!1),f&&(t.addClass("url"),t.append('<span aria-hidden="true"><\/span>')),t.click(function(n){if(n.preventDefault(),f){vr(o,f);return}if(!ir(t)&&(!h||h())){if(u(r.find("button"),!1),u(t,!0),s){s(t);return}var a=function(n){c&&(i=c());i&&cr(i);i=hr();l&&l(i);p.call(t,n)};y()?hi(e,r,function(n){a(n)},!1,!0,function(){w.call(t)}):hi(e,r,function(n){a(n)})}}),t}function yr(t,i,r,f,o){var s=null;o.addClass("dst-question-response-container-button-set");t.Responses.forEach(function(t){var f=$("<div />").appendTo(o);f.addClass("dst-question-response-button");e({questionIndex:i,buttonContainer:f,questionAndConversationContainer:r,text:t.Text+(t.SubText?" <small>("+t.SubText+")<\/small>":""),isSubmit:!1,url:t.DestinationType===n.DestinationType.Url?t.DestinationUrl:null,clickCallback:t.Callback,checkIfAlreadySubmittedCallback:function(){return s!==null},validateCallback:null,submitCallback:function(n){gt(t,n,r);s=$(this)},revertUIStateCallback:function(){u(o.find("button"),!1);u(s,!0)}})})}function pr(n,t,i,r,f){function l(){var n=s.slider("getValue");h.children().removeClass("active");h.children().eq(n-1).addClass("active");o&&(n!==o?u(c,!1):i.is(".dst-question-and-conversation-container-stepback")||u(c,!0))}var o=null,c,s,h;f.addClass("dst-question-response-container-slider");s=$("<input />").appendTo(f).slider({min:1,max:n.Responses.length,value:Math.round(n.Responses.length/2),step:1,selection:"none",tooltip:"hide",focus:!0,formatter:function(t){return n.Responses[t-1].Text}}).on("change",l);f.find(".slider-handle").focus(function(){f.find(".slider").addClass("focus")}).blur(function(){f.find(".slider").removeClass("focus")});h=$("<ul />").appendTo(f);n.Responses.forEach(function(t,i){var r=$("<li />").appendTo(h),u;i===0||i===n.Responses.length-1?r.css("width","calc(100%/"+(n.Responses.length-1)+"/2)"):r.css("width","calc(100%/"+(n.Responses.length-1)+")");u=$("<span />").appendTo(r);u.text(t.Text)});l();c=e({questionIndex:t,buttonContainer:f,questionAndConversationContainer:i,text:"Submit",isSubmit:!0,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return o!==null},validateCallback:null,submitCallback:function(t){o=s.slider("getValue");var r=n.Responses[o-1];gt(r,t,i)},revertUIStateCallback:function(){s.slider("setValue",o);l()}})}function wr(n,t,i,r,f){var s,h,o=null;f.addClass("dst-question-response-container-screener");n.Responses.forEach(function(n,r){var e=$("<fieldset />").appendTo(f),c,h;e.data("response-index",r);e.data("response-id",n.Id);c=$("<legend />").appendTo(e);c.addClass("dst-question-response-screener-text");c.text(n.Text);h=$("<div />").appendTo(e);h.addClass("dst-question-response-screener-options");n.ScreenerChoiceSet.ScreenerChoices.forEach(function(n,e){var c=$("<input />").appendTo(h),l;c.attr("id","dst-question-response-screener-radio-"+t+"-"+r+"-"+e);c.attr("name","dst-question-response-screener-radio-"+t+"-"+r);c.attr("type","radio");c.val(e+1);c.change(function(){o&&(f.find("input:checked")!=o?u(s,!1):i.is(".dst-question-and-conversation-container-stepback")||u(s,!0))});l=$("<label />").appendTo(h);l.attr("for",c.attr("id"));l.text(n.Text)})});s=e({questionIndex:t,buttonContainer:f,questionAndConversationContainer:i,text:"Submit",isSubmit:!0,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return o!==null},validateCallback:function(){var i=!0;return h="",f.find(".dst-question-response-screener-validation-top-error").remove(),f.find(".dst-question-response-screener-validation-error").remove(),f.find("fieldset").removeAttr("aria-describedby"),f.find("fieldset").each(function(){var a=$(this).data("response-id"),o=$(this).data("response-index"),c=$(this).find("input:checked"),l,e,r;c.length?(l=c.val(),h+=a+"~"+l+"~"):(i&&(e=$("<div />"),e.addClass("dst-question-response-screener-validation-top-error"),e.append("<span><\/span>"),e.append("<span>Please answer these questions to continue.<\/span>"),e.prependTo(f)),r=$("<div />"),r.attr("id","dst-question-response-screener-validation-error-"+t+"-"+o),r.addClass("dst-question-response-screener-validation-error"),r.text('Please answer "'+n.Responses[o].Text+'" question'),$(this).attr("aria-describedby",r.attr("id")),$(this).find(".dst-question-response-screener-options").before(r),u(s,!1),i=!1)}),i},submitCallback:function(n){fr(h,n,i);o=f.find("input:checked")},revertUIStateCallback:function(){o.prop("checked",!0)}})}function br(c,l,v,y,p){function wi(n){var f=n.text,e=n.clickCallback,r=n.container,o=n.textTag,s=n.promoCard,i=$("<div />").appendTo(r),t;return i.addClass("dst-bottom-link-container"),t=$("<button />").appendTo(i),t.attr("type","submit"),t.text(f),u(t,!1),t.click(function(n){n.preventDefault();e()}),o===nt&&(s.appendTo(r),setTimeout(function(){SocialBar.init({desktopContainer:"#dst-header-container",mobileContainer:i})},1)),t}var pt,et,ut,tr,tt,ei,ot,wt,oi,k,si,hi,st,d,yt,dt,gt,ai,yi,ft,g,fi,rt,pi;if(p.addClass("dst-question-response-container-free-text"),t===n.FreeTextState.Start){pt=$("<form />").appendTo(v);pt.attr("action","/");pt.attr("method","post");y.appendTo(pt);et=null;tr=140;p.addClass("dst-question-response-container-free-text-start");tt=$("<div />").appendTo(p);tt.addClass("dst-free-text-container");ei=$("<div />").insertBefore(p);ei.addClass("dst-character-limit-error-container");ot=$("<div />").appendTo(tt);ot.addClass("dst-type-something-text-container");ot.text("Type something here...");ot.on("click",function(n){n.preventDefault();k.focus()});wt=$("<span />").appendTo(ot);oi="dst-character-limit-count";wt.attr("id",oi);wt.addClass("dst-character-limit-count-container");k=$("<input />").appendTo(tt);k.attr("title","Type something here");k.attr("placeholder",i[f[t]+vi]);k.attr("aria-describedby",oi);k.val(it);si=k.val();k.on("keydown",function(n){if(n.which==13){n.preventDefault();d.prop("disabled")||d.click();return}si=k.val()});k.on("input",function(){var n=k.val();tt.toggleClass("has-text",n!=="");tt.is(".submitted")&&si!==n&&(tt.removeClass("submitted"),d.removeClass("disappear"),u(d,!1))});hi=new CharacterLimitHandler(140,k,wt,ei);hi.init();st=$("<button />").appendTo(tt);st.addClass("icon-h2h-close");st.attr("type","button");st.attr("aria-label","Clear text");st.click(function(n){n.preventDefault();n.stopImmediatePropagation();tt.removeClass("submitted");d.removeClass("disappear");u(d,!1);k.val("").trigger("input");ut.searchInput.val("");k.focus()});d=e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:"Submit",isSubmit:!0,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return et!==null},validateCallback:function(){return hi.validate()},submitCallback:function(){et=k.val();ni(et,null,v);tt.addClass("submitted");d.addClass("disappear")},revertUIStateCallback:function(){k.val(et).change();ut.searchInput.val(et);tt.addClass("submitted");u(d,!0);d.addClass("disappear")}});wi({text:i[lt],clickCallback:function(){ri(v)},container:y});ut=new SearchBarModalHandler(k,140,function(n){k.val(n);k.trigger("input");k.trigger("keydown");d.click()});ut.init();ut.searchBarModal.addClass("dst");ut.searchBarModal.find(".modal-title").text(c.Title);ut.searchBarModal.find(".search-bar-modal-submit-button").text("Submit");ut.searchBarModal.find(".search-bar-modal-search-input").attr("placeholder",k.attr("placeholder"));ut.searchBarModal.find(".search-bar-modal-search-input").attr("title",c.Title);k.trigger("input")}else if(t===n.FreeTextState.SearchOptions||t===n.FreeTextState.SearchOptionsSpellingFix||t===n.FreeTextState.ListOfOptions)yt=null,dt=r[0],p.addClass("dst-question-response-container-free-text-options"),gt=function(){var n=rt.find(":checked").length;n>0?d.text(i[gi].replace("{number}",n)):d.text(i[di]);dt.Limit>0&&n>=dt.Limit?(rt.find("input:not(:checked)").prop("disabled",!0),rt.find("input:checked").prop("disabled",!1)):rt.find("input").prop("disabled",!1);u(d,!1)},rt=$("<ul />").appendTo(p),dt.Children.forEach(function(n){var e=$("<li />").appendTo(rt),t=$("<label />").appendTo(e),i=$("<input />").appendTo(t),u,r,f;i.attr("type","checkbox");i.data("filter",n);i.change(gt);u=$("<span />").appendTo(t);u.addClass("icon");r=$("<span />").appendTo(t);r.addClass("text");r.text(n.Name);f=$("<span />").appendTo(t);f.addClass("background")}),d=e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:null,isSubmit:!1,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return yt!==null},validateCallback:null,submitCallback:function(){a(function(){h();yt=rt.find(":checked");yt.each(function(){var n=$(this).data("filter");o.push(n)});r.shift();w()},!1)},revertUIStateCallback:function(){rt.find(":checked").prop("checked",!1);yt.prop("checked",!0);gt()}}),gt();else if(t===n.FreeTextState.SearchOneOption){var ti=f[t],ci,li,ft=null,g=null;ci=e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[ti+ct],isSubmit:!1,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return g!==null},validateCallback:null,submitCallback:function(){g=ci;var n=b(i[ti+ct],v);a(function(){h();var n=r[0],t=n.Children[0];o.push(t);r.shift();w()},n)},revertUIStateCallback:function(){u(ci,!1);u(g,!0)},getFreeTextStateDataCallback:function(){return ft},setFreeTextStateDataCallback:function(n){ft=n}});li=e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[ti+ht],isSubmit:!1,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return g!==null},validateCallback:null,submitCallback:function(){g=li;var n=b(i[ti+ht],v);a(function(){h();r.shift();w()},n)},revertUIStateCallback:function(){u(li,!1);u(g,!0)},getFreeTextStateDataCallback:function(){return ft},setFreeTextStateDataCallback:function(n){ft=n}})}else t===n.FreeTextState.SearchNoOptions||t===n.FreeTextState.SearchOneOptionNo?(ft=null,g=null,ai=e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[vt],isSubmit:!1,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return g!==null},validateCallback:null,submitCallback:function(){g=ai;ii()},revertUIStateCallback:function(){u(ai,!1);u(g,!0)},getFreeTextStateDataCallback:function(){return ft},setFreeTextStateDataCallback:function(n){ft=n}}),yi=e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[ki],isSubmit:!1,url:null,clickCallback:null,checkIfAlreadySubmittedCallback:function(){return g!==null},validateCallback:null,submitCallback:function(){g=yi;ri(v)},revertUIStateCallback:function(){u(yi,!1);u(g,!0)},getFreeTextStateDataCallback:function(){return ft},setFreeTextStateDataCallback:function(n){ft=n}})):t===n.FreeTextState.NoOptionsSelected?(e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[bi],isSubmit:!1,url:"/search-resources"}),e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[nr],isSubmit:!1,url:"/crisis-links"}),e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[at],isSubmit:!1,url:null,clickCallback:function(){ui()}})):t===n.FreeTextState.Results||t===n.FreeTextState.ResultsSearchOneOption?(fi=$("<div />").appendTo(v),fi.addClass("dst-free-text-results-container"),rt=$("<ol />").appendTo(fi),o.forEach(function(n){function d(){var n;f.css("white-space","pre-wrap");a.attr("style")||(n=f.height(),n>0&&a.css("height",n+"px"));h.length===v.length?f.html(h):y?(l.text("less"),f.html(h)):(l.text("more"),f.html(v+"&hellip;"));n=f.height();n>0&&a.css("height",n+"px")}var r=uuid(),g=new FilterModel("",Constants.SearchType.Dst),i=new SearchModel(g),p=$("<li />").appendTo(rt),nt=$("<h3 />").appendTo(p),u=$("<button />").appendTo(nt),t,w,c,e;u.attr("type","button");u.attr("data-toggle","collapse");u.attr("data-target","#"+r);u.attr("aria-controls",r);u.text(n.Name);t=$("<div />").appendTo(p);t.attr("id",r);t.attr("tabindex",0);t.addClass("collapse");w=bt.clone(!0,!0);t.append(w);var a=t.find(".template-info-wrapper"),f=t.find(".template-info-text"),l=t.find(".template-info-more-button"),tt=t.find(".template-email-button"),b=t.find(".template-bottom-collapse-button"),it=t.find(".template-results"),k=t.find(".template-results-cards"),h=n.Description,v=h.split(" ").reduce(function(n,t){return n.length>=180?n:n+(n.length?" ":"")+t},""),y=!1;l.click(function(){y=!y;d()});h.length===v.length&&l.hide();tt.data("searchModel",i);b.attr("data-target","#"+r);b.attr("aria-controls",r);c=$("<div />").appendTo(k);c.addClass("spinner");c.addClass("hide");e=$("<div />").appendTo(k);e.addClass("no-results-for-filters");e.text(Constants.Text.NoResultsForSelectedFilters);e.addClass("hide");setTimeout(function(){var f,a,h,l;ko.applyBindings(i,t[0]);f=it.children(".search-filter-container");f.find("input").each(function(){$(this).attr("id",r+"-"+$(this).attr("id"))});f.find("label").each(function(){$(this).attr("for",r+"-"+$(this).attr("for"))});a=new FilterFormHandler(i,f);a.initBinding();h=!1;t.on("show.bs.collapse",function(){h||(h=!0,d(),i.dstFilters=[n].concat(n.Children),i.dstSearchText=s,i.GetInitialCards())});t.on("hidden.bs.collapse",function(){t.removeAttr("aria-expanded")});t.on("shown.bs.collapse",function(){t.removeAttr("aria-expanded")});l=!1;i.IsLoadingResults.subscribe(function(){if(!i.IsLoadingMoreCards())if(i.IsLoadingResults())c.removeClass("hide");else{if(c.addClass("hide"),!l){l=!0;var n=i.ApplicableFilters();f.find(".filter-item").each(function(){var t=$(this),i=t.find("input").val();n.filter(function(n){return n.indexOf(i)!==-1}).length||t.addClass("should-remove")});f.find(".should-remove").remove();f.find("ul").filter(function(){return $(this).children().length===0}).parents(".dropdown").remove();f.find(".dropdown").length&&f.addClass("active")}i.Total()<1?e.removeClass("hide"):e.addClass("hide")}});o.length==1&&u.click()},100)}),pi=kt.clone(),wi({text:i[nt],textTag:nt,clickCallback:function(){pi.remove();lr(v)},container:fi,promoCard:pi})):t===n.FreeTextState.WhatNext&&(e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[at],isSubmit:!1,url:null,clickCallback:function(){ui()}}),e({questionIndex:l,buttonContainer:p,questionAndConversationContainer:v,text:i[vt],isSubmit:!1,url:null,clickCallback:function(){ii()}}))}function hi(t,i,r,f,e,o){function s(n,t){n.css("height","0px");setTimeout(function(){n.parent().removeClass("dst-question-and-conversation-container-stepback");n.remove();t&&t()},500)}function c(){var c=!1,h=y-1-t,f,l,a;h>0||e?(f=$("<div />").appendTo(i),f.addClass("dst-stepback-question-outer-container"),l=$("<div />").appendTo(f),l.addClass("dst-stepback-question-inner-container"),i.addClass("dst-question-and-conversation-container-stepback"),a={QuestionId:-1,QuestionType:n.QuestionType.ButtonSet,Title:"Changing your response will cause you to lose progress.",Text:"If you change your response to the question above, your progress will be lost. You will have to answer some questions again if you continue.",AvatarType:-1,Responses:[{Text:"Change answer and lose progress",Callback:function(n){var l,e,a,p,o;c||(c=!0,u(n,!0),l=yt[t],l!=null&&(v=l),y=y-h,e=$("<div />").insertAfter(i),a=$(),h>0&&(a=k.children(".dst-question-and-conversation-container").slice(-h)),a.appendTo(e),e.css("height",e.height()+"px"),e.css("overflow","hidden"),e.css("transition","all 0.5s ease-in-out"),p=i.find(".dst-conversation-outer-container"),o=$().add(e).add(p),setTimeout(function(){o.css("opacity",0);setTimeout(function(){o.css("height","0px");setTimeout(function(){o.remove();s(f,function(){r(h)})},500)},500)},100))}},{Text:"Keep old answer",Callback:function(n){c||(c=!0,setTimeout(function(){f.parent().next().children().first().focus()},500),u(n,!0),s(f,null),o&&o())}}]},i.find(".dst-conversation-outer-container").appendTo(i),si(a,-t,l,!0),f.css("transition","none"),f.css("height","0px"),setTimeout(function(){f.css("transition","");f.css("height",l.height()+16+"px")},100)):r(0)}var h=i.find(".dst-stepback-question-outer-container");if(f){s(h,null);return}h.length?s(h,c):c()}function ci(n){n==="show"?$("footer").addClass("animation").removeClass("hide"):$("footer").addClass("hide")}function ot(){var t=$(window).scrollTop(),r=$(window).width(),u=$(window).height(),i="",n;t>u/2||(r<=635?(n=1,i+="center "+Math.round(100*n+t/8)+"px",i+=", 25% "+Math.round(-0*n+t/4)+"px",i+=", 85% "+Math.round(-0*n+t/2)+"px",i+=", center "+Math.round(-0*n+t*0)+"px"):(n=r/2560,i+="center "+Math.round(-200*n+t/8)+"px",i+=", center "+Math.round(-200*n+t/4)+"px",i+=", center "+Math.round(-0*n+t/2)+"px",i+=", center "+Math.round(-100*n+t*0)+"px"),tr.css("background-position",i))}var n={DestinationType:{Question:1,Cluster:2,ClusterEnd:3,Url:4},ResponseType:{Standard:1,Cluster:2,Screener:3},QuestionType:{ButtonSet:1,Slider:2,Screener:3,FreeText:4},FreeTextState:{Start:1,SearchOptions:2,SearchOptionsSpellingFix:3,SearchOneOption:4,SearchOneOptionNo:5,SearchNoOptions:6,ListOfOptions:7,NoOptionsSelected:8,Results:9,ResultsSearchOneOption:10,WhatNext:11}},f={};f[n.FreeTextState.Start]="start";f[n.FreeTextState.SearchOptions]="searchOptions";f[n.FreeTextState.SearchOptionsSpellingFix]="searchOptionsSpellingFix";f[n.FreeTextState.SearchOneOption]="searchOneOption";f[n.FreeTextState.SearchOneOptionNo]="searchOneOptionNo";f[n.FreeTextState.SearchNoOptions]="searchNoOptions";f[n.FreeTextState.ListOfOptions]="listOfOptions";f[n.FreeTextState.NoOptionsSelected]="noOptionsSelected";f[n.FreeTextState.Results]="results";f[n.FreeTextState.ResultsSearchOneOption]="resultsSearchOneOption";f[n.FreeTextState.WhatNext]="whatNext";var li="_AccessibilityTitle",ai="_AvatarId",vi="_InputPlaceholder",st="_Limit",ht="_NoButtonText",yi="_Order",pi="_Text",wi="_Title",ct="_YesButtonText",bi="common_BrowseResourcesButtonText",ki="common_ListOfOptionsButtonText",lt="common_ListOfOptionsLinkText",di="common_NoneOfTheseButtonText",at="common_StartOverButtonText",gi="common_SubmitButtonText",vt="common_TypeSomethingElseButtonText",nr="common_ViewCrisisPageButtonText",nt="common_WhatNextLinkText",tr=$("#dst-background"),k=$("#dst-chat"),v="",yt=[""],tt="",y=0,pt=1,ut=1,wt=!1,c=null,bt=null,kt=null,d=location.href,ft="?query=",it="",t=n.FreeTextState.Start,dt=null,i=null,s=null,l=!1,r=null,o=null,g=!1,p=null;$(window).scroll(ot);$(window).resize(ot);$(document).ready(function(){tt=uuid();it=rr();pt=ur();ot();or();c=new SearchModel(new FilterModel("",Constants.SearchType.Dst));ci("hide");var n;n=$("#dst-free-text-results-option-content-template");bt=n.children().clone(!0,!0);n.remove();n=$("#dst-survey-promo-card-template");kt=n.children().clone(!0,!0);n.remove();SocialBar.init({desktopContainer:"#dst-header-container"});it.length>=1&&setTimeout(function(){$(document).trigger("afterready")},1200)});$(document).bind("afterready",function(){$(".dst-question-response-container-free-text").find("button[type=submit]").trigger("click");$.scrollTo(k)})})();
function FilterFormHandler(n,t){this.searchModel=n;this.filterFormContainer=t;this.applyFilterButton=this.filterFormContainer.find(".search-filter-apply-button");this.clearFilterButton=this.filterFormContainer.find(".search-filter-clear-button");this.checkboxList=this.filterFormContainer.find(":checkbox");this.dropdownMenuList=this.filterFormContainer.find(".dropdown-menu");this.selectedFilterList=this.filterFormContainer.find(".selected-filter");this.closeDropdownButtons=this.filterFormContainer.find(".close-dropdown");this.showFiltersButton=$();this.showFiltersModalButton=this.filterFormContainer.find(".search-filter-show-modal");this.initBinding=function(){this.dropdownMenuList.off("click").on("click",$.proxy(this.dropdownEventHandler,this));this.clearFilterButton.off("click").on("click",$.proxy(this.clearFilterEventHandler,this));this.checkboxList.off("click").on("click",$.proxy(this.checkboxEventHandler,this));this.checkboxList.off("keydown").on("keydown",$.proxy(this.checkboxKeydownEventHandler,this));this.closeDropdownButtons.off("click").on("click",$.proxy(this.closeDropdownEventHandler,this));this.applyFilterButton.off("click").on("click",$.proxy(this.applyFilterEventHandler,this));this.showFiltersModalButton.off("click").on("click",$.proxy(this.showModalEventHandler,this))};this.dropdownEventHandler=function(n){n.stopPropagation()};this.closeDropdownEventHandler=function(n){$(n.target).closest(".dropdown").removeClass("open")};this.clearFilterEventHandler=function(){this.searchModel.ClearCheckbox();this.selectedFilterList.text("All");this.selectedFilterList.removeClass("active");this.checkboxList.prop("checked",!1);this.showFiltersButton.find(".search-filter-num-selected").empty()};this.checkboxKeydownEventHandler=function(n){n.keyCode===Constants.KeyCode.Enter?(n.stopPropagation(),n.preventDefault(),n.target.click()):n.keyCode===Constants.KeyCode.Escape&&(n.stopPropagation(),n.preventDefault(),this.closeDropdownEventHandler(n))};this.checkboxEventHandler=function(n){var t=$(n.target),r=t.closest(".dropdown").find(".selected-filter"),o=t.closest(".dropdown").find(":checked"),u=[],i,f,e;o.each(function(){u.push($(this).attr("data-filter-name"))});u.length>0?(r.addClass("active"),r.text(u.join(", "))):(r.removeClass("active"),r.text("All"));i=$();f=this.checkboxList.filter(":checked").length;f>0&&(i=$("<span />"),i.addClass("sr-only"),i.text(" ("+f+" filters applied)"));e=$().add(this.showFiltersButton).add(this.showFiltersModalButton);e.each(function(){var n=$(this);n.find(".search-filter-num-selected").empty().append(i.clone())});this.searchModel.FilterModel().PushFilter(t.attr("data-filter-group-name"),t.attr("value"),t.attr("data-filter-name"))};this.applyFilterEventHandler=function(n){n.preventDefault();this.searchModel.GetInitialCards()};this.showModalEventHandler=function(n){var r;n.preventDefault();var t=Modals.getFilterModal(),i=t.find(".modal-body"),u=t.find(".apply-filters-button");i.length?i.empty():(i=$("<ul />").insertBefore(t.find(".modal-footer")),i.addClass("modal-body"));r=this.applyFilterButton;u.off("click").on("click",function(n){n.preventDefault();t.modal("hide");r.click()});this.filterFormContainer.find(".dropdown").each(function(){var r=$(this),o=$("<li />").appendTo(i),u=uuid(),n=$("<button />").appendTo(o),s,f,t,e;n.attr("type","button");n.attr("data-toggle","collapse");n.attr("data-target","#"+u);n.attr("aria-expanded","false");s=$("<span />").appendTo(n);s.html(r.find(".filter-name").html());f=$("<span />").appendTo(n);f.addClass("selected-filters");f.html(r.find(".selected-filter").html());t=$("<ul />").appendTo(o);t.attr("id",u);t.attr("aria-expanded","false");t.addClass("collapse");e=r.find(".filter-item").clone(!0,!0);e.find("input").each(function(){var n=$(this),t=n.attr("id"),i=$("#"+t);n.attr("id",u+"-"+t);n.off("click").on("click",function(){i.click();f.html(r.find(".selected-filter").html())})});e.find("label").each(function(){var n=$(this);n.attr("for",u+"-"+n.attr("for"))});t.append(e)});t.modal("show",n.currentTarget)}};
function SearchBarModalHandler(n,t,i){this.searchBarModal=null;this.searchInput=null;this.searchButton=null;this.closeButton=null;this.characterLimitErrorContainer=null;this.characterLimitCountContainer=null;this.characterLimitHandler=null;this.toggler=n;this.limit=t;this.callback=i;this.init=function(){var n=Modals.getSearchModal();this.searchBarModal=n;this.searchInput=n.find(".search-bar-modal-search-input");this.searchButton=n.find(".search-bar-modal-submit-button");this.closeButton=n.find(".search-bar-modal-close-button");this.characterLimitErrorContainer=n.find(".search-bar-modal-character-limit-error-container");this.characterLimitCountContainer=n.find(".search-bar-modal-character-limit-count-container");this.setupBindings()};this.setupBindings=function(){this.toggler.off("click").on("click",$.proxy(this.togglerInteractionEventHandler,this));this.toggler.off("focus").on("focus",$.proxy(this.togglerInteractionEventHandler,this));this.searchButton.off("click").on("click",$.proxy(this.searchButtonClickHandler,this));this.searchInput.off("keydown").on("keydown",$.proxy(this.inputKeydownEventHandler,this));this.closeButton.off("click").on("click",$.proxy(this.closeButtonClickHandler,this));this.characterLimitHandler!==null&&this.characterLimitHandler.deinit();this.characterLimitHandler=new CharacterLimitHandler(this.limit,this.searchInput,this.characterLimitCountContainer,this.characterLimitErrorContainer);this.characterLimitHandler.init()};this.togglerInteractionEventHandler=function(n){isMobile()&&(n.preventDefault(),this.searchBarModal.modal("show",$(this.toggler).parents("[tabindex]").first()),this.setupBindings(),setTimeout($.proxy(this.focusSearchInput,this),600))};this.closeButtonClickHandler=function(n){n.preventDefault();this.searchBarModal.modal("hide")};this.focusSearchInput=function(){this.searchInput.focus()};this.searchButtonClickHandler=function(n){n.preventDefault();this.validateAndCallCallback()};this.inputKeydownEventHandler=function(n){n.keyCode===13&&(this.searchInput.change(),n.stopPropagation(),n.preventDefault(),this.validateAndCallCallback())};this.validateAndCallCallback=function(){this.characterLimitHandler.validate()&&(this.callback&&typeof this.callback=="function"&&this.callback(this.searchInput.val()),this.searchInput.blur(),this.searchBarModal.modal("hide"))}};