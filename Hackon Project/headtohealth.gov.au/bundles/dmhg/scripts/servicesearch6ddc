window.dmhgContainer||(window.dmhgContainer={}),function(){function f(n){return n.replace(/^\s+/,"")}function e(n,t){$(function(){o(n,t)})}function o(e,o){function c(){h&&(h.remove(),s.removeClass("dmhg-autocomplete-input"),h=null,y.off("click",c))}function l(){h&&h.empty();p&&p.remove();VOArray=[];b=-1}function w(){}var y=$("body"),s=$("#"+e);s.attr("autocomplete","off");var a="",h,b=-1,v=[],p;s.keyup(function(e){function b(){function g(u,f){var v,h,w,y,p,b,o;if(u.length!=0)for(v=null,h=0,w=u.length;h<w;h++){if(u[h]instanceof Array){y=$('<div role="list"><\/div>');v?(g(u[h],y),v.append(y)):(p=$('<div role="listitem"><\/div>'),p.css(n),g(u[h],y),p.append(y),f.append(p));continue}b=u[h];o=$("<button>"+b+"<\/button>");o.attr("aria-label",o.text());o.css(t);o.click(function(){var n=u[h];s.val($(this).text()).change();l();c();s.focus();a=s.val();window.performSearch()});o.on("keyup keypress",function(n){if(n.keyCode==13){var t=u[h];return s.val($(this).text()).change(),l(),c(),s.focus(),a=s.val(),window.performSearch(),!1}});o.focus(function(){$(this).css(i)});o.blur(function(){$(this).css(r)});e.push(o);v=$('<div role="listitem"><\/li>');v.css(n);v.append(o);f.append(v)}}var e,b,nt,k,d,f;if(a=p,l(),!h){h=$('<div role="list" class="dmhg-autocomplete"><\/div>');h.css(u);s.after(h);s.addClass("dmhg-autocomplete-input");y.on("click",c)}for(e=[],v=o(p),v.length==0&&(s.val()!=""?(f=$('<button role="presentation">No matches<\/button>'),f.css(t),f.click(function(){l();c();s.focus();a=s.val()}),f.focus(function(){$(this).css(i)}),f.blur(function(){$(this).css(r)}),f.keydown(function(n){n.which==27&&(l(),s.focus())}),f.keydown(function(n){n.which==38&&s.focus()}),b=$('<div role="listitem"><\/li>'),b.css(n),b.append(f),h.append(b),e.push(f)):(l(),c())),g(v,h),nt=s.offset(),w(s,h),k=1,d=e.length-1;k<d;k++)(function(n){var t=e[n];t.keydown(function(t){t.which==27?(l(),c(),s.focus()):t.which==40?(e[n+1].focus(),t.preventDefault()):t.which==38&&(e[n-1].focus(),t.preventDefault())})})(k);e.length>1?(f=e[0],f.keydown(function(n){n.which==27?(l(),c(),s.focus()):n.which==40?(e[1].focus(),n.preventDefault()):n.which==38&&(s.focus(),n.preventDefault())}),f=e[d],f.keydown(function(n){n.which==27?(l(),c(),s.focus()):n.which==40?n.preventDefault():n.which==38&&(e[d-1].focus(),n.preventDefault())})):e.length==1&&(f=e[0],f.keydown(function(n){n.which==27?(l(),c(),s.focus()):n.which==40?n.preventDefault():n.which==38&&(s.focus(),n.preventDefault())}));s.after(h)}if(e.which!=9){var p=f(s.val());p!=a&&setTimeout(b,0)}});s.keydown(function(n){if(n.which==40){h&&setTimeout(function(){h.children(":first-child").children().focus()},100);n.preventDefault();return}});$(window).resize(function(){w(s,h)})}var u={},n={},t={},i={},r={};window.dmhgContainer.makeAutocomplete=e}();
function SearchBarHandler(n,t){this.searchModel=n;this.searchButton=$("#search-bar-submit-button");this.searchInput=$("#search-bar-search-input");this.clearInput=$("#search-bar-clear-input-button");this.showFiltersButton=$("#search-bar-show-filters-button");this.showFiltersModalButton=$("#search-bar-show-filters-modal-button");this.searchQueryLabelPrintable=$("#search-query-label-printable");this.searchQueryTextPrintable=$("#search-query-text-printable");this.searchQueryMarginPrintable=$("#content-search-result-container");this.contentSearchResultContainer=$("#content-search-result-container");this.initBinding=function(){this.searchButton.off("click").on("click",$.proxy(this.applySearchOnClickEventHandler,this));this.searchInput.off("keydown").on("keydown",$.proxy(this.applySearchOnKeyStrokeEventHandler,this));this.searchInput.off("input").on("input",$.proxy(this.inputHasChangedEventHandler,this));this.clearInput.off("click").on("click",$.proxy(this.clearEventHandler,this));this.showFiltersButton.off("click").on("click",$.proxy(this.showFiltersEventHandler,this))};this.applySearchOnClickEventHandler=function(n){n.preventDefault();this.performSearch()};this.applySearchOnKeyStrokeEventHandler=function(n){n.keyCode===Constants.KeyCode.Enter&&(n.stopPropagation(),n.preventDefault(),this.performSearch())};this.inputHasChangedEventHandler=function(){this.searchInput.val()==""?this.clearInput.removeClass("active"):this.clearInput.addClass("active");this.setPrintableFields()};this.setPrintableFields=function(){this.searchInput.val().length>=1?(this.searchQueryLabelPrintable.addClass("active"),this.searchQueryTextPrintable.addClass("active").text(this.searchInput.val())):(this.searchQueryLabelPrintable.removeClass("active"),this.searchQueryTextPrintable.removeClass("active"))};this.clearEventHandler=function(){this.searchInput.val("").focus();this.clearInput.removeClass("active");this.clearInput.removeClass("ready");var n=this;setTimeout(function(){n.clearInput.addClass("ready")},300)};this.showFiltersEventHandler=function(){if(!t.is(".closing")){t.is(".open")?(t.addClass("closing"),setTimeout(function(){t.removeClass("open");t.removeClass("closing")},500),this.showFiltersButton.removeClass("open"),this.contentSearchResultContainer.removeClass("filters-open")):(t.addClass("open"),t.addClass("opening"),setTimeout(function(){t.removeClass("opening")},500),this.showFiltersButton.addClass("open"),this.contentSearchResultContainer.addClass("filters-open"));var n=this.showFiltersButton.attr("aria-label");this.showFiltersButton.attr("aria-label",this.showFiltersButton.data("toggle-aria-label"));this.showFiltersButton.data("toggle-aria-label",n)}};this.performSearch=function(){this.searchInput.change();this.setPrintableFields();EmailFormHandlerGlobal&&EmailFormHandlerGlobal.resetEmailForm();this.searchModel.ClearCurrentCache();this.searchModel.SpellCheckKeywords(!0);this.searchModel.GetInitialCards()}};
function AutocorrectBarHandler(n){this.searchModel=n;this.autocorrectBarElement=$("#content-search-autocorrect-bar");this.originalTermButton=$("#content-search-autocorrect-original-search-button");this.initBinding=function(){this.originalTermButton.off("click").on("click",$.proxy(this.applyDefaultSearchOnClickEventHandler,this));this.searchModel.EnableSuggestion.subscribe($.proxy(this.activateAutocorrectBar,this));this.searchModel.Suggestion.subscribe($.proxy(this.newSuggestionEventHandler,this));this.searchModel.OriginalTerm.subscribe($.proxy(this.originalTermEventHandler,this))};this.applyDefaultSearchOnClickEventHandler=function(n){n.preventDefault();this.searchModel.SearchInstead()};this.activateAutocorrectBar=function(){this.searchModel.EnableSuggestion()?this.autocorrectBarElement.addClass("active"):this.autocorrectBarElement.removeClass("active")};this.newSuggestionEventHandler=function(){this.searchModel.EnableSuggestion()?this.autocorrectBarElement.addClass("active"):this.autocorrectBarElement.removeClass("active")};this.originalTermEventHandler=function(){this.originalTermButton.text((this.searchModel.OriginalTerm()||"").trim())}};
function InfoBarHandler(n){this.searchModel=n;this.infoBarElement=$("#content-search-info-bar");this.numResourcesElement=$("#content-search-num-resources");this.emailMobileButton=$("#mobile-show-email-button");this.initBinding=function(){this.searchModel.Total.subscribe($.proxy(this.newResourcesEventHandler,this))};this.newResourcesEventHandler=function(){var n="",t=this.searchModel.Total();if(t>0){var r=this.searchModel.OriginalTerm(),i=!r,u=this.searchModel.Suggestion()||r;n+=i?"We have ":"We found ";n+='<span id="search-result-information-count">'+t+"<\/span> ";n+=i?"digital mental health resource":"resource";n+=t===1?"":"s";n+=i?"":' for <span id="search-result-information-term">'+u+"<\/span>"}this.numResourcesElement.html(n);t>0?(this.infoBarElement.addClass("active"),this.emailMobileButton.addClass("active")):(this.infoBarElement.removeClass("active"),this.emailMobileButton.removeClass("active"))}};
function FilterFormHandler(n,t){this.searchModel=n;this.filterFormContainer=t;this.applyFilterButton=this.filterFormContainer.find(".search-filter-apply-button");this.clearFilterButton=this.filterFormContainer.find(".search-filter-clear-button");this.checkboxList=this.filterFormContainer.find(":checkbox");this.dropdownMenuList=this.filterFormContainer.find(".dropdown-menu");this.selectedFilterList=this.filterFormContainer.find(".selected-filter");this.closeDropdownButtons=this.filterFormContainer.find(".close-dropdown");this.showFiltersButton=$();this.showFiltersModalButton=this.filterFormContainer.find(".search-filter-show-modal");this.initBinding=function(){this.dropdownMenuList.off("click").on("click",$.proxy(this.dropdownEventHandler,this));this.clearFilterButton.off("click").on("click",$.proxy(this.clearFilterEventHandler,this));this.checkboxList.off("click").on("click",$.proxy(this.checkboxEventHandler,this));this.checkboxList.off("keydown").on("keydown",$.proxy(this.checkboxKeydownEventHandler,this));this.closeDropdownButtons.off("click").on("click",$.proxy(this.closeDropdownEventHandler,this));this.applyFilterButton.off("click").on("click",$.proxy(this.applyFilterEventHandler,this));this.showFiltersModalButton.off("click").on("click",$.proxy(this.showModalEventHandler,this))};this.dropdownEventHandler=function(n){n.stopPropagation()};this.closeDropdownEventHandler=function(n){$(n.target).closest(".dropdown").removeClass("open")};this.clearFilterEventHandler=function(){this.searchModel.ClearCheckbox();this.selectedFilterList.text("All");this.selectedFilterList.removeClass("active");this.checkboxList.prop("checked",!1);this.showFiltersButton.find(".search-filter-num-selected").empty()};this.checkboxKeydownEventHandler=function(n){n.keyCode===Constants.KeyCode.Enter?(n.stopPropagation(),n.preventDefault(),n.target.click()):n.keyCode===Constants.KeyCode.Escape&&(n.stopPropagation(),n.preventDefault(),this.closeDropdownEventHandler(n))};this.checkboxEventHandler=function(n){var t=$(n.target),r=t.closest(".dropdown").find(".selected-filter"),o=t.closest(".dropdown").find(":checked"),u=[],i,f,e;o.each(function(){u.push($(this).attr("data-filter-name"))});u.length>0?(r.addClass("active"),r.text(u.join(", "))):(r.removeClass("active"),r.text("All"));i=$();f=this.checkboxList.filter(":checked").length;f>0&&(i=$("<span />"),i.addClass("sr-only"),i.text(" ("+f+" filters applied)"));e=$().add(this.showFiltersButton).add(this.showFiltersModalButton);e.each(function(){var n=$(this);n.find(".search-filter-num-selected").empty().append(i.clone())});this.searchModel.FilterModel().PushFilter(t.attr("data-filter-group-name"),t.attr("value"),t.attr("data-filter-name"))};this.applyFilterEventHandler=function(n){n.preventDefault();this.searchModel.GetInitialCards()};this.showModalEventHandler=function(n){var r;n.preventDefault();var t=Modals.getFilterModal(),i=t.find(".modal-body"),u=t.find(".apply-filters-button");i.length?i.empty():(i=$("<ul />").insertBefore(t.find(".modal-footer")),i.addClass("modal-body"));r=this.applyFilterButton;u.off("click").on("click",function(n){n.preventDefault();t.modal("hide");r.click()});this.filterFormContainer.find(".dropdown").each(function(){var r=$(this),o=$("<li />").appendTo(i),u=uuid(),n=$("<button />").appendTo(o),s,f,t,e;n.attr("type","button");n.attr("data-toggle","collapse");n.attr("data-target","#"+u);n.attr("aria-expanded","false");s=$("<span />").appendTo(n);s.html(r.find(".filter-name").html());f=$("<span />").appendTo(n);f.addClass("selected-filters");f.html(r.find(".selected-filter").html());t=$("<ul />").appendTo(o);t.attr("id",u);t.attr("aria-expanded","false");t.addClass("collapse");e=r.find(".filter-item").clone(!0,!0);e.find("input").each(function(){var n=$(this),t=n.attr("id"),i=$("#"+t);n.attr("id",u+"-"+t);n.off("click").on("click",function(){i.click();f.html(r.find(".selected-filter").html())})});e.find("label").each(function(){var n=$(this);n.attr("for",u+"-"+n.attr("for"))});t.append(e)});t.modal("show",n.currentTarget)}};
function SearchBarModalHandler(n,t,i){this.searchBarModal=null;this.searchInput=null;this.searchButton=null;this.closeButton=null;this.characterLimitErrorContainer=null;this.characterLimitCountContainer=null;this.characterLimitHandler=null;this.toggler=n;this.limit=t;this.callback=i;this.init=function(){var n=Modals.getSearchModal();this.searchBarModal=n;this.searchInput=n.find(".search-bar-modal-search-input");this.searchButton=n.find(".search-bar-modal-submit-button");this.closeButton=n.find(".search-bar-modal-close-button");this.characterLimitErrorContainer=n.find(".search-bar-modal-character-limit-error-container");this.characterLimitCountContainer=n.find(".search-bar-modal-character-limit-count-container");this.setupBindings()};this.setupBindings=function(){this.toggler.off("click").on("click",$.proxy(this.togglerInteractionEventHandler,this));this.toggler.off("focus").on("focus",$.proxy(this.togglerInteractionEventHandler,this));this.searchButton.off("click").on("click",$.proxy(this.searchButtonClickHandler,this));this.searchInput.off("keydown").on("keydown",$.proxy(this.inputKeydownEventHandler,this));this.closeButton.off("click").on("click",$.proxy(this.closeButtonClickHandler,this));this.characterLimitHandler!==null&&this.characterLimitHandler.deinit();this.characterLimitHandler=new CharacterLimitHandler(this.limit,this.searchInput,this.characterLimitCountContainer,this.characterLimitErrorContainer);this.characterLimitHandler.init()};this.togglerInteractionEventHandler=function(n){isMobile()&&(n.preventDefault(),this.searchBarModal.modal("show",$(this.toggler).parents("[tabindex]").first()),this.setupBindings(),setTimeout($.proxy(this.focusSearchInput,this),600))};this.closeButtonClickHandler=function(n){n.preventDefault();this.searchBarModal.modal("hide")};this.focusSearchInput=function(){this.searchInput.focus()};this.searchButtonClickHandler=function(n){n.preventDefault();this.validateAndCallCallback()};this.inputKeydownEventHandler=function(n){n.keyCode===13&&(this.searchInput.change(),n.stopPropagation(),n.preventDefault(),this.validateAndCallCallback())};this.validateAndCallCallback=function(){this.characterLimitHandler.validate()&&(this.callback&&typeof this.callback=="function"&&this.callback(this.searchInput.val()),this.searchInput.blur(),this.searchBarModal.modal("hide"))}};
(function(){function nt(n){var t=$("#"+n+""),i,r;t.length>0&&(i=170,r=$("#nav-survey-container"),r.length===1&&r.is(":visible")&&(i=i+r.height()),$("html, body").animate({scrollTop:t.parent().offset().top-i},"slow",function(){t.focus();t.attr("tabindex",0)}),history.pushState("",document.title,window.location.pathname))}function w(){var r,u,o,s,f,h,c,l,e,i;if(n.NoResultsTexts()!==undefined)for(l=$(".mobile-filters-count"),t.removeClass("hidden").empty(),l&&t.addClass("filter-showed"),$("<h3/>",{id:"service-finder-results-nothing-found-heading"}).addClass("sr-only").text(n.NoResultsTexts().AriaHeading).appendTo(t),$("<div/>",{id:"service-finder-results-nothing-found-description"}).text(n.NoResultsTexts().Description).appendTo(t),$("<h3/>",{id:"service-finder-results-nothing-found-hints-heading"}).addClass("sr-only").text(n.NoResultsTexts().HintsHeading).appendTo(t),$("<ul/>",{id:"service-finder-results-nothing-found-hints",tabindex:0}).addClass("no-result-cards").appendTo(t),e=$("#service-finder-results-nothing-found-hints"),i=0;i<n.NoResultsTexts().Hints.length;i++)n.NoResultsTexts().Hints[i].Hidden===!1&&(o=n.NoResultsTexts().Hints[i].Image.Src!=null?'<img src="'+n.NoResultsTexts().Hints[i].Image.Src+'" alt="'+n.NoResultsTexts().Hints[i].Image.Alt+'" />':"",s=n.NoResultsTexts().Hints[i].BackgroundColor!=null?' style="background-color:'+n.NoResultsTexts().Hints[i].BackgroundColor+'" ':"",n.NoResultsTexts().Hints[i].Link!=null?(f=n.NoResultsTexts().Hints[i].Link.Url,h=n.NoResultsTexts().Hints[i].Link.Title,c=n.NoResultsTexts().Hints[i].Link.Text,u=" onclick=\"location.href='"+f+'\';"  onmouseover= "this.style.cursor=\'pointer\'"  onmouseout= "this.style.cursor=\'auto\'"  onfocus="this.focus();"  role="listitem"',r='<a class="action-button" href="'+f+'" title="'+h+'" >'+c+"<\/a>"):(r="",u=""),e.html(e.html()+'<li id="no-result-card-'+i+'" class="content-card no-result-card no-result-content-card grid-view appear-animation" '+s+u+' tabindex="0">'+o+'<h4 class="internal-title">'+n.NoResultsTexts().Hints[i].Title+"<\/h4>"+r+"<\/li>"))}function tt(){t.addClass("hidden").empty()}function it(){i.removeClass("active");c.removeClass("active");l.removeClass("active");o.removeClass("active");tt();e.addClass("active").attr("aria-label",Constants.Text.Loading).attr("aria-live","polite").attr("tabindex",0);ut([i,c,l,o,e],300,null)}function rt(){var u,t,f;if(e.removeClass("active").removeAttr("aria-label").removeAttr("aria-live").removeAttr("tabindex"),u=window.location.hash.substr(1),u&&nt(u),i.addClass("active"),n.Total()<1?w():o.addClass("active"),r){r=null;var c=$("#content-search-result-container"),s=$("#nav-survey-container"),l=$("#nav-top-links"),a=$("#nav-nav-links"),s=$("#nav-survey-container"),v=$("#mobile-header"),h=$("#content-search-num-resources");g.addClass("sticky");t=c.offset().top;f=s.length?s.height():0;t=isDesktop()?t-(f+l.height()+a.height()-5):t-(f+v.height()+30);$("html,body").animate({scrollTop:t},"slow",function(){h.attr("tabindex",0);h.focus()})}}function ut(n,t,i){if($.isArray(n))for(var r=0;r<n.length;r++)n[r].removeClass("ready");else n.removeClass("ready");setTimeout(function(){if($.isArray(n))for(var t=0;t<n.length;t++)n[t].addClass("ready");else n.addClass("ready");i!=null&&$.isFunction(i)&&i()},t)}function ft(){return performance.navigation.type!==1&&store.session.get(Constants.SessionStorage.CardCache)&&!r}function b(){if(a.length){var n=a.offset().top-u.offset().top;$(window).scrollTop()>=n?u.addClass("sticky"):u.is(".sticky")&&u.removeClass("sticky")}}function h(t,i){v.attr("aria-pressed",t);y.attr("aria-pressed",!t);n.IsInGridView(t);i?s.attr("aria-live","polite"):s.removeAttr("aria-live");s.text((t?"Grid":"List")+" view enabled");store.session.set(Constants.SessionStorage.CardsIsInGridView,t);sendSessionStorageToOtherTabs()}var u=$("#content-search"),f=$("#search-bar-search-input"),e=$("#content-search-results-spinner"),i=$(".search-filter-container"),c=$("#content-search-autocorrect-bar"),l=$("#content-search-info-bar"),o=$(".content-search-results-container-div"),k=$("#search-result-information-open-email-form-button"),d=$("#mobile-show-email-button"),t=$("#service-finder-results-nothing-found-placeholder"),g=$("header"),a=$("#content-search-bar-and-filters-sticky-container"),s=$("#search-result-information-view-text-sr"),v=$("#search-result-information-view-grid-button"),y=$("#search-result-information-view-list-button"),r=getUrlParameter("search"),p=$(".Banner").find(".youtube-video"),n=null;v.on("click",function(){h(!0,!0)});y.on("click",function(){h(!1,!0)});$(document).ready(function(){var e,t,o,s,c,u;SocialBar.init({desktopContainer:"#content-search-social-bar-desktop-container",mobileContainer:"#content-search-social-bar-mobile-container"});b();(typeof p=="undefined"||p.length===0)&&(e=new JumpToContentHandler("search-bar-search-input"),e.initBinding());n=new SearchModel(new FilterModel("",Constants.SearchType.SearchService));n.IsSearchPage(!0);ko.applyBindings(n);k.data("searchModel",n);d.data("searchModel",n);h(store.session.get(Constants.SessionStorage.CardsIsInGridView)!==!1,!1);t=new SearchBarHandler(n,i);t.initBinding();o=new SearchBarModalHandler(f,null,function(n){f.val(n);t.searchButton.click()});o.init();s=new AutocorrectBarHandler(n);s.initBinding();c=new InfoBarHandler(n);c.initBinding();u=new FilterFormHandler(n,i);u.showFiltersButton=t.showFiltersButton;u.showFiltersModalButton=t.showFiltersModalButton;u.initBinding();u.clearFilterButton.click();r&&(f.val(decodeURI(r)).change().trigger("input"),window.history.replaceState({},document.title,window.location.pathname));setTimeout(function(){if(ft()){n.GetCacheCardDetails();var t=[];n.FilterModel().SearchFilterGroups().forEach(function(n){n.FilterIds().forEach(function(n){t.push(n)})});n.FilterModel().SearchFilterGroups([]);n.FilterModel().EmailFilters([]);n.FilterModel().FilterName([]);t.forEach(function(n){var t=$("#input-"+n);t.click()})}else n.GetCards()},1);n.IsLoadingResults.subscribe(function(){n.IsLoadingMoreCards()||(n.IsLoadingResults()?it():rt())});n.NoResultsTexts.subscribe(function(){n.Total()<1&&w()});$(".social-bar.desktop button:first-of-type, .social-bar.desktop button:last-of-type").on("focus",function(){$("html,body").animate({scrollTop:0},"slow")})});$(window).on("scroll",function(){b()})})(window.ContentSearch=window.ContentSearch||{});